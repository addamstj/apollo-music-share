{"ast":null,"code":"var _jsxFileName = \"/Users/tjaddams/Downloads/apollo-music-share/src/components/AddSong.js\";\nimport React from \"react\";\nimport { TextField, InputAdornment, Button, Dialog, DialogTitle, DialogContent, DialogActions, makeStyles } from \"@material-ui/core\";\nimport { Link, AddBoxOutlined } from \"@material-ui/icons\";\nimport ReactPlayer from \"react-player\";\nimport SoundcloudPlayer from \"react-player/lib/players/SoundCloud\";\nimport YoutubePlayer from \"react-player/lib/players/YouTube\";\nimport { useMutation } from \"@apollo/react-hooks\";\nimport { ADD_SONG } from \"../graphql/mutations\";\nconst useStyles = makeStyles(theme => ({\n  container: {\n    display: \"flex\",\n    alignItems: \"center\"\n  },\n  urlInput: {\n    margin: theme.spacing(1)\n  },\n  addSongButton: {\n    margin: theme.spacing(1)\n  },\n  dialog: {\n    textAlign: \"center\"\n  },\n  thumbnail: {\n    width: \"90%\"\n  }\n}));\nconst DEFAULT_SONG = {\n  duration: 0,\n  title: \"\",\n  artist: \"\",\n  thumbnail: \"\"\n};\n\nfunction AddSong() {\n  const classes = useStyles();\n  const [addSong, {\n    error\n  }] = useMutation(ADD_SONG);\n  const [url, setUrl] = React.useState(\"\");\n  const [playable, setPlayable] = React.useState(false);\n  const [dialog, setDialog] = React.useState(false);\n  const [song, setSong] = React.useState(DEFAULT_SONG);\n  React.useEffect(() => {\n    const isPlayable = SoundcloudPlayer.canPlay(url) || YoutubePlayer.canPlay(url);\n    setPlayable(isPlayable);\n  }, [url]);\n\n  function handleChangeSong(event) {\n    const {\n      name,\n      value\n    } = event.target;\n    setSong(prevSong => ({ ...prevSong,\n      [name]: value\n    }));\n  }\n\n  function handleCloseDialog() {\n    setDialog(false);\n  }\n\n  async function handleEditSong({\n    player\n  }) {\n    const nestedPlayer = player.player.player;\n    let songData;\n\n    if (nestedPlayer.getVideoData) {\n      songData = getYoutubeInfo(nestedPlayer);\n    } else if (nestedPlayer.getCurrentSound) {\n      songData = await getSoundcloudInfo(nestedPlayer);\n    }\n\n    setSong({ ...songData,\n      url\n    });\n  }\n\n  async function handleAddSong() {\n    try {\n      const {\n        url,\n        thumbnail,\n        duration,\n        title,\n        artist\n      } = song;\n      await addSong({\n        variables: {\n          url: url.length > 0 ? url : null,\n          thumbnail: thumbnail.length > 0 ? thumbnail : null,\n          duration: duration > 0 ? duration : null,\n          title: title.length > 0 ? title : null,\n          artist: artist.length > 0 ? artist : null\n        }\n      });\n      handleCloseDialog();\n      setSong(DEFAULT_SONG);\n      setUrl(\"\");\n    } catch (error) {\n      console.error(\"Error adding song\", error);\n    }\n  }\n\n  function getYoutubeInfo(player) {\n    const duration = player.getDuration();\n    const {\n      title,\n      video_id,\n      author\n    } = player.getVideoData();\n    const thumbnail = `http://img.youtube.com/vi/${video_id}/0.jpg`;\n    return {\n      duration,\n      title,\n      artist: author,\n      thumbnail\n    };\n  }\n\n  function getSoundcloudInfo(player) {\n    return new Promise(resolve => {\n      player.getCurrentSound(songData => {\n        if (songData) {\n          resolve({\n            duration: Number(songData.duration / 1000),\n            title: songData.title,\n            artist: songData.user.username,\n            thumbnail: songData.artwork_url.replace(\"-large\", \"-t500x500\")\n          });\n        }\n      });\n    });\n  }\n\n  function handleError(field) {\n    var _error$graphQLErrors$, _error$graphQLErrors$2;\n\n    return error === null || error === void 0 ? void 0 : (_error$graphQLErrors$ = error.graphQLErrors[0]) === null || _error$graphQLErrors$ === void 0 ? void 0 : (_error$graphQLErrors$2 = _error$graphQLErrors$.extensions) === null || _error$graphQLErrors$2 === void 0 ? void 0 : _error$graphQLErrors$2.path.includes(field);\n  }\n\n  const {\n    thumbnail,\n    title,\n    artist\n  } = song;\n  return React.createElement(\"div\", {\n    className: classes.container,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, React.createElement(Dialog, {\n    className: classes.dialog,\n    open: dialog,\n    onClose: handleCloseDialog,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }, React.createElement(DialogTitle, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }, \"Edit Song\"), React.createElement(DialogContent, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, React.createElement(\"img\", {\n    src: thumbnail,\n    alt: \"Song thumbnail\",\n    className: classes.thumbnail,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143\n    },\n    __self: this\n  }), React.createElement(TextField, {\n    value: title,\n    onChange: handleChangeSong,\n    margin: \"dense\",\n    name: \"title\",\n    label: \"Title\",\n    fullWidth: true,\n    error: handleError(\"title\"),\n    helperText: handleError(\"title\") && \"Fill out field\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }), React.createElement(TextField, {\n    value: artist,\n    onChange: handleChangeSong,\n    margin: \"dense\",\n    name: \"artist\",\n    label: \"Artist\",\n    fullWidth: true,\n    error: handleError(\"artist\"),\n    helperText: handleError(\"artist\") && \"Fill out field\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }), React.createElement(TextField, {\n    value: thumbnail,\n    onChange: handleChangeSong,\n    margin: \"dense\",\n    name: \"thumbnail\",\n    label: \"Thumbnail\",\n    fullWidth: true,\n    error: handleError(\"thumbnail\"),\n    helperText: handleError(\"thumbnail\") && \"Fill out field\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  })), React.createElement(DialogActions, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179\n    },\n    __self: this\n  }, React.createElement(Button, {\n    onClick: handleCloseDialog,\n    color: \"secondary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180\n    },\n    __self: this\n  }, \"Cancel\"), React.createElement(Button, {\n    onClick: handleAddSong,\n    variant: \"outlined\",\n    color: \"primary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183\n    },\n    __self: this\n  }, \"Add Song\"))), React.createElement(TextField, {\n    className: classes.urlInput,\n    onChange: event => setUrl(event.target.value),\n    value: url,\n    placeholder: \"Add Youtube or Soundcloud Url\",\n    fullWidth: true,\n    margin: \"normal\",\n    type: \"url\",\n    InputProps: {\n      startAdornment: React.createElement(InputAdornment, {\n        position: \"start\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, React.createElement(Link, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }))\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188\n    },\n    __self: this\n  }), React.createElement(Button, {\n    disabled: !playable,\n    className: classes.addSongButton,\n    onClick: () => setDialog(true),\n    variant: \"contained\",\n    color: \"primary\",\n    endIcon: React.createElement(AddBoxOutlined, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204\n    },\n    __self: this\n  }, \"Add\"), React.createElement(ReactPlayer, {\n    url: url,\n    hidden: true,\n    onReady: handleEditSong,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214\n    },\n    __self: this\n  }));\n}\n\nexport default AddSong;","map":{"version":3,"sources":["/Users/tjaddams/Downloads/apollo-music-share/src/components/AddSong.js"],"names":["React","TextField","InputAdornment","Button","Dialog","DialogTitle","DialogContent","DialogActions","makeStyles","Link","AddBoxOutlined","ReactPlayer","SoundcloudPlayer","YoutubePlayer","useMutation","ADD_SONG","useStyles","theme","container","display","alignItems","urlInput","margin","spacing","addSongButton","dialog","textAlign","thumbnail","width","DEFAULT_SONG","duration","title","artist","AddSong","classes","addSong","error","url","setUrl","useState","playable","setPlayable","setDialog","song","setSong","useEffect","isPlayable","canPlay","handleChangeSong","event","name","value","target","prevSong","handleCloseDialog","handleEditSong","player","nestedPlayer","songData","getVideoData","getYoutubeInfo","getCurrentSound","getSoundcloudInfo","handleAddSong","variables","length","console","getDuration","video_id","author","Promise","resolve","Number","user","username","artwork_url","replace","handleError","field","graphQLErrors","extensions","path","includes","startAdornment"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport {\n  TextField,\n  InputAdornment,\n  Button,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  makeStyles\n} from \"@material-ui/core\"\nimport { Link, AddBoxOutlined } from \"@material-ui/icons\"\nimport ReactPlayer from \"react-player\"\nimport SoundcloudPlayer from \"react-player/lib/players/SoundCloud\"\nimport YoutubePlayer from \"react-player/lib/players/YouTube\"\nimport { useMutation } from \"@apollo/react-hooks\"\nimport { ADD_SONG } from \"../graphql/mutations\"\n\nconst useStyles = makeStyles(theme => ({\n  container: {\n    display: \"flex\",\n    alignItems: \"center\"\n  },\n  urlInput: {\n    margin: theme.spacing(1)\n  },\n  addSongButton: {\n    margin: theme.spacing(1)\n  },\n  dialog: {\n    textAlign: \"center\"\n  },\n  thumbnail: {\n    width: \"90%\"\n  }\n}))\n\nconst DEFAULT_SONG = {\n  duration: 0,\n  title: \"\",\n  artist: \"\",\n  thumbnail: \"\"\n}\n\nfunction AddSong() {\n  const classes = useStyles()\n  const [addSong, { error }] = useMutation(ADD_SONG)\n  const [url, setUrl] = React.useState(\"\")\n  const [playable, setPlayable] = React.useState(false)\n  const [dialog, setDialog] = React.useState(false)\n  const [song, setSong] = React.useState(DEFAULT_SONG)\n\n  React.useEffect(() => {\n    const isPlayable =\n      SoundcloudPlayer.canPlay(url) || YoutubePlayer.canPlay(url)\n    setPlayable(isPlayable)\n  }, [url])\n\n  function handleChangeSong(event) {\n    const { name, value } = event.target\n    setSong(prevSong => ({\n      ...prevSong,\n      [name]: value\n    }))\n  }\n\n  function handleCloseDialog() {\n    setDialog(false)\n  }\n\n  async function handleEditSong({ player }) {\n    const nestedPlayer = player.player.player\n    let songData\n    if (nestedPlayer.getVideoData) {\n      songData = getYoutubeInfo(nestedPlayer)\n    } else if (nestedPlayer.getCurrentSound) {\n      songData = await getSoundcloudInfo(nestedPlayer)\n    }\n    setSong({ ...songData, url })\n  }\n\n  async function handleAddSong() {\n    try {\n      const { url, thumbnail, duration, title, artist } = song\n      await addSong({\n        variables: {\n          url: url.length > 0 ? url : null,\n          thumbnail: thumbnail.length > 0 ? thumbnail : null,\n          duration: duration > 0 ? duration : null,\n          title: title.length > 0 ? title : null,\n          artist: artist.length > 0 ? artist : null\n        }\n      })\n      handleCloseDialog()\n      setSong(DEFAULT_SONG)\n      setUrl(\"\")\n    } catch (error) {\n      console.error(\"Error adding song\", error)\n    }\n  }\n\n  function getYoutubeInfo(player) {\n    const duration = player.getDuration()\n    const { title, video_id, author } = player.getVideoData()\n    const thumbnail = `http://img.youtube.com/vi/${video_id}/0.jpg`\n    return {\n      duration,\n      title,\n      artist: author,\n      thumbnail\n    }\n  }\n\n  function getSoundcloudInfo(player) {\n    return new Promise(resolve => {\n      player.getCurrentSound(songData => {\n        if (songData) {\n          resolve({\n            duration: Number(songData.duration / 1000),\n            title: songData.title,\n            artist: songData.user.username,\n            thumbnail: songData.artwork_url.replace(\"-large\", \"-t500x500\")\n          })\n        }\n      })\n    })\n  }\n\n  function handleError(field) {\n    return error?.graphQLErrors[0]?.extensions?.path.includes(field)\n  }\n\n  const { thumbnail, title, artist } = song\n  return (\n    <div className={classes.container}>\n      <Dialog\n        className={classes.dialog}\n        open={dialog}\n        onClose={handleCloseDialog}\n      >\n        <DialogTitle>Edit Song</DialogTitle>\n        <DialogContent>\n          <img\n            src={thumbnail}\n            alt=\"Song thumbnail\"\n            className={classes.thumbnail}\n          />\n          <TextField\n            value={title}\n            onChange={handleChangeSong}\n            margin=\"dense\"\n            name=\"title\"\n            label=\"Title\"\n            fullWidth\n            error={handleError(\"title\")}\n            helperText={handleError(\"title\") && \"Fill out field\"}\n          />\n          <TextField\n            value={artist}\n            onChange={handleChangeSong}\n            margin=\"dense\"\n            name=\"artist\"\n            label=\"Artist\"\n            fullWidth\n            error={handleError(\"artist\")}\n            helperText={handleError(\"artist\") && \"Fill out field\"}\n          />\n          <TextField\n            value={thumbnail}\n            onChange={handleChangeSong}\n            margin=\"dense\"\n            name=\"thumbnail\"\n            label=\"Thumbnail\"\n            fullWidth\n            error={handleError(\"thumbnail\")}\n            helperText={handleError(\"thumbnail\") && \"Fill out field\"}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleCloseDialog} color=\"secondary\">\n            Cancel\n          </Button>\n          <Button onClick={handleAddSong} variant=\"outlined\" color=\"primary\">\n            Add Song\n          </Button>\n        </DialogActions>\n      </Dialog>\n      <TextField\n        className={classes.urlInput}\n        onChange={event => setUrl(event.target.value)}\n        value={url}\n        placeholder=\"Add Youtube or Soundcloud Url\"\n        fullWidth\n        margin=\"normal\"\n        type=\"url\"\n        InputProps={{\n          startAdornment: (\n            <InputAdornment position=\"start\">\n              <Link />\n            </InputAdornment>\n          )\n        }}\n      />\n      <Button\n        disabled={!playable}\n        className={classes.addSongButton}\n        onClick={() => setDialog(true)}\n        variant=\"contained\"\n        color=\"primary\"\n        endIcon={<AddBoxOutlined />}\n      >\n        Add\n      </Button>\n      <ReactPlayer url={url} hidden onReady={handleEditSong} />\n    </div>\n  )\n}\n\nexport default AddSong\n"]},"metadata":{},"sourceType":"module"}